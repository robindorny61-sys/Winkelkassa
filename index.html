import React, { useState } from "react";

const producten = {
  // ...gebruik hier je hele productlijst
};

export default function WinkelApp() {
  const [gekozenCategorie, setGekozenCategorie] = useState(null);
  const [winkelwagen, setWinkelwagen] = useState({});
  const [korting, setKorting] = useState(0);
  const [kortingInvoeren, setKortingInvoeren] = useState(false);
  const [betaalKeuze, setBetaalKeuze] = useState(null); // "bancontact" of "cash"

  function voegToe(product) {
    setWinkelwagen((prev) => {
      const nieuweAantal = (prev[product.naam]?.aantal || 0) + 1;
      return {
        ...prev,
        [product.naam]: { ...product, aantal: nieuweAantal },
      };
    });
  }

  function verwijder(productNaam) {
    setWinkelwagen((prev) => {
      const nieuw = { ...prev };
      if (nieuw[productNaam]) {
        if (nieuw[productNaam].aantal > 1) {
          nieuw[productNaam].aantal -= 1;
        } else {
          delete nieuw[productNaam];
        }
      }
      return nieuw;
    });
  }

  function totaalPrijs() {
    const totaal = Object.values(winkelwagen).reduce(
      (acc, p) => acc + p.prijs * p.aantal,
      0
    );
    return totaal * ((100 - korting) / 100);
  }

  return (
    <div style={{ padding: "20px", fontFamily: "Arial" }}>
      {!gekozenCategorie && (
        <>
          <h1>Kies een categorie</h1>
          <ul style={{ listStyle: "none", paddingLeft: 0 }}>
            {Object.keys(producten).map((cat) => (
              <li
                key={cat}
                style={{
                  cursor: "pointer",
                  padding: "8px",
                  border: "1px solid #ccc",
                  margin: "5px 0",
                  borderRadius: "5px",
                }}
                onClick={() => setGekozenCategorie(cat)}
              >
                {cat}
              </li>
            ))}
          </ul>
        </>
      )}

      {gekozenCategorie && (
        <>
          <button onClick={() => setGekozenCategorie(null)} style={{ marginBottom: "10px" }}>
            ← Terug naar categorieën
          </button>
          <h2>Producten in {gekozenCategorie}</h2>
          <ul style={{ listStyle: "none", paddingLeft: 0 }}>
            {producten[gekozenCategorie].map((product) => (
              <li
                key={product.naam}
                style={{ padding: "6px", borderBottom: "1px solid #eee" }}
              >
                {product.naam} — €{product.prijs.toFixed(2)}{" "}
                <button onClick={() => voegToe(product)} style={{ marginLeft: "10px" }}>
                  + Toevoegen
                </button>
              </li>
            ))}
          </ul>
        </>
      )}

      <hr />

      <h2>Winkelwagen</h2>
      {Object.keys(winkelwagen).length === 0 && <p>Je winkelwagen is leeg</p>}
      {Object.values(winkelwagen).map((item) => (
        <div key={item.naam} style={{ marginBottom: "10px" }}>
          {item.naam} — {item.aantal} × €{item.prijs.toFixed(2)} = €
          {(item.aantal * item.prijs).toFixed(2)}{" "}
          <button onClick={() => voegToe(item)}>+</button>{" "}
          <button onClick={() => verwijder(item.naam)}>-</button>
        </div>
      ))}

      {Object.keys(winkelwagen).length > 0 && (
        <>
          {!kortingInvoeren ? (
            <button onClick={() => setKortingInvoeren(true)}>Korting invoeren</button>
          ) : (
            <>
              <input
                type="number"
                value={korting}
                onChange={(e) => setKorting(Number(e.target.value))}
                max={100}
                min={0}
                placeholder="Kortingspercentage"
                style={{ width: "100px", marginRight: "10px" }}
              />
              <button onClick={() => setKortingInvoeren(false)}>Bevestigen</button>
            </>
          )}

          <h3>Totaal: €{totaalPrijs().toFixed(2)}</h3>

          {!betaalKeuze ? (
            <>
              <p>Betaal met:</p>
              <button onClick={() => setBetaalKeuze("bancontact")}>Bancontact</button>{" "}
              <button onClick={() => setBetaalKeuze("cash")}>Cash</button>
            </>
          ) : (
            <>
              {betaalKeuze === "bancontact" && (
                <>
                  <p>Scan de QR-code hieronder om te betalen (demo QR-code):</p>
                  <img
                    src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=bancontact-demo"
                    alt="Bancontact QR-code"
                  />
                </>
              )}
              {betaalKeuze === "cash" && <p>Betaal contant aan de kassa.</p>}

              <button onClick={() => {
                setWinkelwagen({});
                setKorting(0);
                setBetaalKeuze(null);
              }}>
                Transactie afronden
              </button>
            </>
          )}
        </>
      )}
    </div>
  );
}
